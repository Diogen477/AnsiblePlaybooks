# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ansible_for_GitLabRunner

## üìÅ –ö–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã
```
ansible_for_GitLabRunner_fixed/
‚îú‚îÄ‚îÄ ansible.cfg                 # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
‚îú‚îÄ‚îÄ inventory                   # Inventory —Å –≥—Ä—É–ø–ø–∞–º–∏
‚îú‚îÄ‚îÄ site.yml                    # –ì–ª–∞–≤–Ω—ã–π playbook —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –û–°
‚îú‚îÄ‚îÄ requirements.yml            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π
‚îú‚îÄ‚îÄ .gitignore                  # –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ README.md                   # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (58KB)
‚îú‚îÄ‚îÄ CHANGES.md                  # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ QUICKSTART.md               # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
```

## üìÇ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```
group_vars/
‚îú‚îÄ‚îÄ all.yml                     # –ü—É–±–ª–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ vault.yml.example           # –ü—Ä–∏–º–µ—Ä vault —Ñ–∞–π–ª–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
```

## üé≠ –†–æ–ª–∏

### ‚úÖ common - –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```
roles/common/
‚îú‚îÄ‚îÄ tasks/main.yml              # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, xRDP
‚îú‚îÄ‚îÄ handlers/main.yml           # Handler –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ xRDP
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (safe –≤–º–µ—Å—Ç–æ dist)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ —Ç–µ–≥–∏ never/system_update
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã handlers

### ‚úÖ java - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java
```
roles/java/
‚îú‚îÄ‚îÄ tasks/main.yml              # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Azul Zulu 17
‚îú‚îÄ‚îÄ handlers/main.yml           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ó–∞–º–µ–Ω–∞ apt_key –Ω–∞ get_url + /etc/apt/keyrings/
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å signed-by
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ JAVA_HOME
- ‚úÖ Handlers –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ edt - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 1C:EDT
```
roles/edt/
‚îú‚îÄ‚îÄ tasks/main.yml              # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ EDT
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ EDT (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- ‚úÖ Block/always –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ timeout –∏ retries

### ‚úÖ platform - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 1C:Platform
```
roles/platform/
‚îú‚îÄ‚îÄ tasks/main.yml              # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Platform
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ EDT - –≤—Å–µ —Ç–µ –∂–µ —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è, block/always, timeout

### ‚úÖ sonar-scanner - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarScanner
```
roles/sonar-scanner/
‚îú‚îÄ‚îÄ tasks/main.yml              # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarScanner
‚îú‚îÄ‚îÄ handlers/main.yml           # Handler –¥–ª—è reload environment
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å PATH (profile.d –≤–º–µ—Å—Ç–æ /etc/environment)
- ‚úÖ –ù–µ –∑–∞—Ç–∏—Ä–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π PATH
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã alternatives
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ

### üÜï gitlab-user - –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ù–û–í–ê–Ø –†–û–õ–¨)
```
roles/gitlab-user/
‚îú‚îÄ‚îÄ tasks/main.yml              # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è gitlab-runner
‚îú‚îÄ‚îÄ defaults/main.yml           # Defaults –¥–ª—è —Ä–æ–ª–∏
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è gitlab-runner
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SSH –∫–ª—é—á–µ–π

### ‚úÖ rdp-tools - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RDP
```
roles/rdp-tools/
‚îú‚îÄ‚îÄ tasks/main.yml              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ xRDP
‚îú‚îÄ‚îÄ handlers/main.yml           # Handlers –¥–ª—è restart/reload xRDP
‚îî‚îÄ‚îÄ meta/main.yml               # –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ Root –¥–æ—Å—Ç—É–ø –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (rdp_allow_root: false)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ root –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—Å–æ–∫–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Handlers –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω –ª–∏—à–Ω–∏–π sudo –∏–∑ –∫–æ–º–∞–Ω–¥

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º

### –†–∞–∑–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ä–∏–≥–∏–Ω–∞–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π |
|---------|----------|--------------|
| –§–∞–π–ª–æ–≤ | 13 | 35+ |
| –†–æ–ª–µ–π | 6 | 7 |
| Handlers | 0 | 6 |
| Meta —Ñ–∞–π–ª–æ–≤ | 0 | 7 |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | 0 | 3 —Ñ–∞–π–ª–∞ (README, CHANGES, QUICKSTART) |

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
| –ê—Å–ø–µ–∫—Ç | –û—Ä–∏–≥–∏–Ω–∞–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π |
|--------|----------|--------------|
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å credentials | ‚ùå –û—Ç–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç | ‚úÖ Ansible Vault |
| apt_key | ‚ùå Deprecated | ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ |
| Root RDP | ‚ùå –í–∫–ª—é—á–µ–Ω | ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã | ‚ùå dist-upgrade | ‚úÖ safe + —Ç–µ–≥–∏ |
| PATH | ‚ùå –ó–∞—Ç–∏—Ä–∞–µ—Ç—Å—è | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |
| Handlers | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç | ‚úÖ –í–µ–∑–¥–µ –≥–¥–µ –Ω—É–∂–Ω–æ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –û–° | ‚ùå –ù–µ—Ç | ‚úÖ Pre-tasks —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ |
| –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è |

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. ‚úÖ Ansible Vault –¥–ª—è credentials
2. ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–º–µ—Å—Ç–æ root
3. ‚úÖ Root RDP –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
4. ‚úÖ –í—ã—Å–æ–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ RDP
5. ‚úÖ .gitignore –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
1. ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ Ansible (–±–µ–∑ deprecated)
2. ‚úÖ Handlers –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. ‚úÖ Meta –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ pre-tasks
5. ‚úÖ Block/always –¥–ª—è cleanup

### –£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
1. ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README 400+ —Å—Ç—Ä–æ–∫)
2. ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (QUICKSTART)
3. ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (CHANGES)
4. ‚úÖ –¢–µ–≥–∏ –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
5. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –ì–∏–±–∫–æ—Å—Ç—å
1. ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ timeout/retries
2. ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ —Ç–µ–≥–∏
3. ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø—É—Ç–µ–π
4. ‚úÖ Defaults –¥–ª—è —Ä–æ–ª–µ–π
5. ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

## üì• –§–æ—Ä–º–∞—Ç—ã –∞—Ä—Ö–∏–≤–æ–≤

–î–æ—Å—Ç—É–ø–Ω—ã –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞:
1. **ansible_for_GitLabRunner_fixed.tar.gz** (17 KB) - –¥–ª—è Linux/Mac
2. **ansible_for_GitLabRunner_fixed.zip** (39 KB) - –¥–ª—è Windows

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤
tar -xzf ansible_for_GitLabRunner_fixed.tar.gz
cd ansible_for_GitLabRunner_fixed

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ vault
cp group_vars/vault.yml.example group_vars/vault.yml
nano group_vars/vault.yml
ansible-vault encrypt group_vars/vault.yml

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
ansible-galaxy collection install -r requirements.yml

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
ansible-playbook site.yml --ask-vault-pass

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å
sudo passwd gitlab-runner
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–°–º–æ—Ç—Ä–∏—Ç–µ:
- `README.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `QUICKSTART.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `CHANGES.md` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
